<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MundialApp 2026</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="css/app.css">
</head>
<body>
    <div class="app-container">
        <!-- Columna de Grupos (Servidores) -->
        <nav class="servers-column" id="groups-list">
            <!-- Ãcono para Torneo de Predicciones -->
            <div class="server-icon tournament-icon" id="tournament-btn" title="Torneo de Predicciones">ğŸ†</div>
            
            <!-- Ãcono para Mensajes Directos -->
            <div class="server-icon dm-icon" id="dm-btn" title="Mensajes Directos">ğŸ’¬</div>
            
            <div class="server-separator"></div>
            <div class="server-icon add-server" id="add-group-btn" title="Crear Grupo">+</div>
        
            <a href="tienda.html" class="server-icon shop-icon" title="Tienda del Mundial">
            ğŸ›’
            </a>

            <div class="logout-btn" id="logout-btn" title="Cerrar SesiÃ³n">ğŸšª</div>
        </nav>

        <!-- Columna de Canales y Tareas -->
        <aside class="channels-column">
            <div class="channels-header" id="group-name-header">Selecciona un Grupo</div>
            <div id="channels-container"></div>
        </aside>

        <!-- Columna de Mensajes Directos (oculta por defecto) -->
        <aside class="dm-column d-none" id="dm-column">
            <div class="channels-header">
                <span>ğŸ’¬ Mensajes Directos</span>
                <span class="add-dm-btn" id="add-dm-btn" title="Nuevo mensaje">+</span>
            </div>
            
            <!-- Solicitudes pendientes -->
            <div id="dm-requests-section" class="dm-requests-section"></div>
            
            <!-- Conversaciones -->
            <div id="dm-conversations-list"></div>
        </aside>

        <!-- Vista Principal (Chat y Miembros) -->
        <main class="main-view">
            <header class="chat-header">
                <h2>Selecciona un canal</h2>
                <div class="header-icons">
                    <span id="video-call-btn" onclick="startVideoCall()" title="Iniciar videollamada" style="display: none;">ğŸ“¹</span>
                    <span onclick="showInventory()" title="Mi Inventario">ğŸ’</span>
                    <span onclick="showMembersPanel()" title="Ver miembros">ğŸ‘¥</span>
                    <span onclick="showGroupOptions()" title="Opciones">âš™ï¸</span>
                </div>
            </header>
            <div class="content-area">
                <div class="chat-area">
                    <div class="chat-messages">
                        <div class="message">
                            <div class="message-content">
                                <div class="message-header">
                                    <strong class="user-name">Sistema</strong>
                                    <span class="timestamp">Ahora</span>
                                </div>
                                <div class="message-text">Â¡Bienvenido a MundialApp 2026! ğŸ†<br>Selecciona un grupo y canal para comenzar a chatear.</div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-box">
                        <div class="input-actions">
                            <span onclick="prepareLocationShare()" title="Compartir ubicaciÃ³n" class="action-icon">ğŸ“</span>
                            <span onclick="prepareFileUpload()" title="Subir archivo" class="action-icon">ğŸ“</span>
                            <span id="encryption-toggle" onclick="toggleEncryption()" title="EncriptaciÃ³n desactivada" class="action-icon encryption-off">ğŸ”“</span>
                        </div>
                        <input type="text" placeholder="Selecciona un canal para comenzar..." disabled>
                        <button class="btn" disabled>Enviar</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Vista del Torneo de Predicciones -->
    <div id="tournament-view" class="tournament-main-view d-none">
        <main class="tournament-content-wrapper">
            <header class="tournament-header">
                <h2>ğŸ† Copa Mundial FIFA 2026</h2>
                <div class="tournament-tabs">
                    <button class="tab-btn active" onclick="showTournamentTab('predictions')">ğŸ”® Predicciones</button>
                    <button class="tab-btn" onclick="showTournamentTab('leaderboard')">ğŸ… Leaderboard</button>
                    <button class="tab-btn" onclick="showTournamentTab('groups')">Fase de Grupos</button>
                    <button class="tab-btn" onclick="showTournamentTab('knockout')">EliminaciÃ³n Directa</button>
                    <button class="tab-btn" onclick="showTournamentTab('standings')">ClasificaciÃ³n</button>
                </div>
            </header>

            <div class="tournament-content">
                <!-- Predicciones -->
                <div id="tab-predictions" class="tab-content active">
                    <div class="predictions-header">
                        <h3>ğŸ”® Predicciones de Jornada</h3>
                        <div class="jornada-selector">
                            <button class="btn-secondary" onclick="changePredictionJornada(-1)">â† Anterior</button>
                            <span id="current-jornada-name">Jornada 1 - Fase de Grupos</span>
                            <button class="btn-secondary" onclick="changePredictionJornada(1)">Siguiente â†’</button>
                        </div>
                    </div>
                    <div id="predictions-container">
                        <p style="text-align: center; color: var(--text-muted); padding: 40px;">
                            Cargando predicciones...
                        </p>
                    </div>
                    <div class="predictions-actions" style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" id="submit-predictions-btn" onclick="submitPredictions()">ğŸ’¾ Guardar Predicciones</button>
                    </div>
                </div>

                <!-- Leaderboard -->
                <div id="tab-leaderboard" class="tab-content">
                    <div class="leaderboard-header">
                        <h3>ğŸ… Tabla de ClasificaciÃ³n</h3>
                        <div class="leaderboard-selector">
                            <button class="btn-secondary" onclick="changeLeaderboardJornada(-1)">â† Anterior</button>
                            <span id="current-leaderboard-jornada">Jornada 1</span>
                            <button class="btn-secondary" onclick="changeLeaderboardJornada(1)">Siguiente â†’</button>
                        </div>
                    </div>
                    <div id="leaderboard-container">
                        <p style="text-align: center; color: var(--text-muted); padding: 40px;">
                            Cargando leaderboard...
                        </p>
                    </div>
                </div>

                <!-- Fase de Grupos -->
                <div id="tab-groups" class="tab-content">
                    <div class="groups-header-bar">
                        <button class="restart-btn" id="restart-tournament-btn" onclick="restartTournament()">ğŸ”„ Reiniciar Torneo</button>
                        <button class="simulate-all-btn" id="simulate-all-btn" onclick="simulateAllMatches()">âš¡ Simular Fase de Grupos</button>
                    </div>
                    <div class="groups-grid" id="groups-container"></div>
                </div>

                <!-- EliminaciÃ³n Directa -->
                <div id="tab-knockout" class="tab-content">
                    <div class="groups-header-bar">
                        <button class="simulate-all-btn" id="simulate-knockout-btn" onclick="simulateAllKnockout()" style="display: none;">âš¡ Simular Toda la EliminaciÃ³n Directa</button>
                    </div>
                    <div class="knockout-stage" id="knockout-container">
                        <p style="text-align: center; color: var(--text-muted); padding: 40px;">
                            La fase de eliminaciÃ³n directa comenzarÃ¡ cuando termine la fase de grupos.
                        </p>
                    </div>
                </div>

                <!-- ClasificaciÃ³n -->
                <div id="tab-standings" class="tab-content">
                    <div class="standings-container" id="standings-container">
                        <h3 style="color: var(--text-color); margin-bottom: 20px;">Clasificados a Octavos de Final</h3>
                        <div id="qualified-teams"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Ventana para crear un grupo nuevo -->
    <div id="add-group-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Crear un nuevo Grupo</h3>
            <p>Dale un nombre a tu nuevo grupo de la Copa Mundial.</p>
            <input type="text" id="new-group-name" placeholder="Ej: SelecciÃ³n Mexicana">
            <div class="modal-actions">
                <button id="cancel-create-group" class="btn btn-secondary">Cancelar</button>
                <button id="confirm-create-group" class="btn btn-primary">Crear</button>
            </div>
        </div>
    </div>
    
    <!-- Ventana para las opciones de llamada -->
    <div id="call-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Opciones de llamada</h3>
            <div class="modal-actions" style="justify-content: center;">
                <button class="btn btn-secondary" onclick="alert('FunciÃ³n de llamada - PrÃ³ximamente')">Hacer Llamada</button>
                <button class="btn btn-primary" onclick="startVideoCall(); closeModal();">Hacer Videollamada</button>
            </div>
            <button id="cancel-call" class="btn btn-secondary" style="margin-top: 15px;" onclick="closeModal()">Cancelar</button>
        </div>
    </div>

    <!-- Modal de Videollamada -->
    <!-- Modal de Videollamada -->
<div id="video-call-modal" class="video-call-modal" style="display: none;">
    <div class="video-call-container">
        <div class="video-call-header">
            <h3 id="call-room-name">Videollamada</h3>
            <button class="end-call-btn" onclick="endVideoCall()">ğŸ”´ Finalizar</button>
        </div>
        
        <div id="videos-grid" class="videos-grid">
            <!-- Video remoto -->
            <div class="video-wrapper" id="remote-video-wrapper" style="display: none;">
                <video id="remote-video" autoplay playsinline></video>
                <div class="video-label" id="remote-user-name">Usuario</div>
            </div>
            
            <!-- Video local -->
            <div class="video-wrapper">
                <video id="local-video" autoplay playsinline muted></video>
                <div class="video-label">TÃº</div>
            </div>
        </div>
        
        <div class="call-controls">
            <button class="control-btn" id="toggle-mic" onclick="toggleMic()" title="Silenciar">ğŸ¤</button>
            <button class="control-btn" id="toggle-camera" onclick="toggleCamera()" title="CÃ¡mara">ğŸ“¹</button>
            <button class="control-btn" onclick="shareScreen()" title="Compartir pantalla">ğŸ“º</button>
        </div>
    </div>
</div>

    <!-- NotificaciÃ³n de llamada entrante (SimplePeer) -->
    <div id="incoming-call-modal" class="call-notification" style="display: none;">
        <div class="call-notification-content">
            <div class="call-icon">ğŸ“</div>
            <div class="call-info">
                <strong id="caller-name">Usuario</strong>
                <p>te estÃ¡ llamando...</p>
            </div>
            <div class="call-actions">
                <button class="btn-join-call" id="accept-call-btn">âœ… Aceptar</button>
                <button class="btn-dismiss-call" id="reject-call-btn">âŒ Rechazar</button>
            </div>
        </div>
    </div>

    <!-- Enlace al archivo JavaScript -->
    <!-- Socket.IO para seÃ±alizaciÃ³n en tiempo real -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- SimplePeer para WebRTC simplificado -->
    <script src="https://cdn.jsdelivr.net/npm/simple-peer@9.11.1/simplepeer.min.js"></script>
    
    <script src="js/tasks.js"></script>
    <script src="js/predictions.js"></script>
    <script src="js/tournament.js"></script>
    <script src="js/app.js"></script>
    <script src="js/videocall.js"></script>
</body>
</html>